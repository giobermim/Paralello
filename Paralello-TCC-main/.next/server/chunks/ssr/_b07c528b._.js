module.exports=[10600,a=>{"use strict";var b=a.i(37936),c=a.i(29024),d=a.i(18558),e=a.i(5246);async function f(){if((await (0,e.cookies)()).get("bypass_user"))return null;{let a=await (0,c.createServiceRoleClient)(),{data:{user:b}}=await a.auth.getUser();return b?.id||null}}async function g(){let a=await f(),b=await (0,c.createServiceRoleClient)(),d=b.from("evento").select("*").order("evento_data",{ascending:!0});d=null===a?d.is("usuario_id",null):d.eq("usuario_id",a);let[{data:e,error:g},{data:h}]=await Promise.all([d,b.from("tag").select("*")]);if(g)return{error:g.message};let i=e?.map(a=>a.evento_id)||[];console.log("[v0] Eventos encontrados:",i.length);let{data:j,error:k}=await b.from("tag_has_evento").select("*").in("evento_id",i);console.log("[v0] Tag relations encontradas:",j?.length||0,k?.message||"");let l=new Map;j?.forEach(a=>{let b=String(a.evento_id);l.has(b)||l.set(b,[]),l.get(b).push(a.tag_id)});let m=new Map(h?.map(a=>[a.tag_id,a]));return{data:(e||[]).map(a=>{let b=(l.get(String(a.evento_id))||[]).map(a=>m.get(a)).filter(Boolean);return console.log("[v0] Evento",a.evento_id,"tags:",b.length),{...a,tags:b}})}}async function h(a){let b=await f(),e=await (0,c.createServiceRoleClient)(),g=a.get("titulo"),h=a.get("descricao"),i=a.get("data"),j="true"===a.get("notificacao"),k=a.get("tag_ids"),{data:l,error:m}=await e.from("evento").insert({evento_titulo:g,evento_descricao:h,evento_data:i,evento_notificacao:j,usuario_id:b}).select().single();if(m)return{error:m.message};if(k){let a=k.split(",").filter(Boolean).map(a=>({evento_id:l.evento_id,tag_id:Number.parseInt(a)})),{error:b}=await e.from("tag_has_evento").insert(a);b&&console.error("Error adding tags:",b)}return(0,d.revalidatePath)("/agenda/calendario"),{success:!0,data:l}}async function i(a,b){let e=await f(),g=await (0,c.createServiceRoleClient)(),h=b.get("titulo"),i=b.get("descricao"),j=b.get("data"),k="true"===b.get("notificacao"),l=b.get("tag_ids"),m=g.from("evento").update({evento_titulo:h,evento_descricao:i,evento_data:j,evento_notificacao:k}).eq("evento_id",a);m=null===e?m.is("usuario_id",null):m.eq("usuario_id",e);let{error:n}=await m;if(n)return{error:n.message};if(await g.from("tag_has_evento").delete().eq("evento_id",Number.parseInt(a)),l){let b=l.split(",").filter(Boolean).map(b=>({evento_id:Number.parseInt(a),tag_id:Number.parseInt(b)}));await g.from("tag_has_evento").insert(b)}return(0,d.revalidatePath)("/agenda/calendario"),{success:!0}}async function j(a){let b=await f(),e=await (0,c.createServiceRoleClient)();return await Promise.all([e.from("tag_has_evento").delete().eq("evento_id",Number.parseInt(a)),(async()=>{let c=e.from("evento").delete().eq("evento_id",a);return null===b?c.is("usuario_id",null):c.eq("usuario_id",b)})()]),(0,d.revalidatePath)("/agenda/calendario"),{success:!0}}async function k(){let a=await f(),b=await (0,c.createServiceRoleClient)(),d=new Date().toISOString().split("T")[0],e=b.from("evento").select("*").eq("evento_data",d).eq("evento_notificacao",!0).order("evento_titulo",{ascending:!0});e=null===a?e.is("usuario_id",null):e.eq("usuario_id",a);let[{data:g,error:h},{data:i}]=await Promise.all([e,b.from("tag").select("*")]);if(h)return{error:h.message};let j=g?.map(a=>a.evento_id)||[],{data:k}=await b.from("tag_has_evento").select("*").in("evento_id",j),l=new Map;k?.forEach(a=>{let b=String(a.evento_id);l.has(b)||l.set(b,[]),l.get(b).push(a.tag_id)});let m=new Map(i?.map(a=>[a.tag_id,a]));return{data:(g||[]).map(a=>{let b=(l.get(String(a.evento_id))||[]).map(a=>m.get(a)).filter(Boolean);return{...a,tags:b}})}}(0,a.i(13095).ensureServerEntryExports)([g,h,i,j,k]),(0,b.registerServerReference)(g,"00ed5b835271d4cc4b8bf9cdca3bc525bc25d1274a",null),(0,b.registerServerReference)(h,"40f6ad126f174a86dd081f1986bf5166b4aec8fe18",null),(0,b.registerServerReference)(i,"60c6cd1767d79d6703e220f89d796da5fca0e1adae",null),(0,b.registerServerReference)(j,"4005ef675c21e61f593e536aed03f7e1aa4b652fbb",null),(0,b.registerServerReference)(k,"004848681f943a2fa6a735a7603fa78aeb2eff524a",null),a.s(["createEvento",()=>h,"deleteEvento",()=>j,"getEventos",()=>g,"getTodayNotifications",()=>k,"updateEvento",()=>i])},92352,a=>{"use strict";var b=a.i(37936),c=a.i(29024),d=a.i(5246);async function e(){if((await (0,d.cookies)()).get("bypass_user"))return"00000000-0000-0000-0000-000000000000";let a=await (0,c.createServerClient)(),{data:{user:b}}=await a.auth.getUser();return b?.id||null}async function f(){try{let a=await e();if(!a)return{success:!1,error:"Usuário não autenticado"};let b=await (0,c.createServerClient)(),{data:d,error:f}=await b.from("perfil_usuario").select("*").eq("usuario_id",a).maybeSingle();if(f)return console.error("Erro ao buscar perfil:",f),{success:!1,error:f.message};return{success:!0,data:d}}catch(a){return console.error("Erro ao buscar perfil:",a),{success:!1,error:"Erro ao buscar perfil"}}}async function g(a,b){try{let d=await e();if(!d)return{success:!1,error:"Usuário não autenticado"};let f=await (0,c.createServerClient)(),{data:g}=await f.from("perfil_usuario").select("perfil_id").eq("usuario_id",d).maybeSingle();if(g){let{error:c}=await f.from("perfil_usuario").update({perfil_nome:a,perfil_foto:b,updated_at:new Date().toISOString()}).eq("usuario_id",d);if(c)return console.error("Erro ao atualizar perfil:",c),{success:!1,error:c.message}}else{let{error:c}=await f.from("perfil_usuario").insert({usuario_id:d,perfil_nome:a,perfil_foto:b});if(c)return console.error("Erro ao criar perfil:",c),{success:!1,error:c.message}}return{success:!0}}catch(a){return console.error("Erro ao salvar perfil:",a),{success:!1,error:"Erro ao salvar perfil"}}}(0,a.i(13095).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"001eee0ea2e32480cb65d838a8d69f2bc0ee4cb26f",null),(0,b.registerServerReference)(g,"605ad3937fcec750aa54a721f03bd83763ab184165",null),a.s(["getProfile",()=>f,"saveProfile",()=>g])},84974,a=>{"use strict";var b=a.i(37936),c=a.i(29024),d=a.i(18558),e=a.i(5246),f=a.i(13095);let g={"Língua Portuguesa":1,Literatura:2,Redação:3,"Língua Estrangeira":4,Matemática:5,Física:6,Química:7,Biologia:8,História:9,Geografia:10,Sociologia:11,Filosofia:12,Pausa:13},h={"7 AM":{inicio:"07:00:00",fim:"08:00:00"},"8 AM":{inicio:"08:00:00",fim:"09:00:00"},"9 AM":{inicio:"09:00:00",fim:"10:00:00"},"10 AM":{inicio:"10:00:00",fim:"11:00:00"},"11 AM":{inicio:"11:00:00",fim:"12:00:00"},"12 PM":{inicio:"12:00:00",fim:"13:00:00"},"1 PM":{inicio:"13:00:00",fim:"14:00:00"},"2 PM":{inicio:"14:00:00",fim:"15:00:00"},"3 PM":{inicio:"15:00:00",fim:"16:00:00"},"4 PM":{inicio:"16:00:00",fim:"17:00:00"},"5 PM":{inicio:"17:00:00",fim:"18:00:00"}},i={Dom:0,Seg:1,Ter:2,Qua:3,Qui:4,Sex:5,Sáb:6};async function j(){let a=(await (0,e.cookies)()).get("bypass_user"),b=await (0,c.createServiceRoleClient)();if(a?.value){console.log("[v0] Bypass user encontrado:",a.value);let{data:{users:c},error:d}=await b.auth.admin.listUsers();if(d)return console.log("[v0] Erro ao buscar usuários:",d.message),null;let e=c.find(b=>b.email===a.value);return e?(console.log("[v0] Usuário encontrado pelo bypass:",e.id),e.id):(console.log("[v0] Usuário não encontrado pelo email:",a.value),null)}let d=await (0,c.createServerClient)(),{data:{user:f}}=await d.auth.getUser();return console.log("[v0] getUserId - user:",f?.id,f?.email),f?.id||null}async function k(a){let b=await j(),e=await (0,c.createServiceRoleClient)();if(console.log("[v0] Salvando cronograma para userId:",b),!b)return console.log("[v0] Usuário não autenticado!"),{error:"Usuário não autenticado. Faça login para salvar cronogramas."};let{data:f,error:k}=await e.from("cronograma").insert({cronograma_titulo:a.titulo,usuario_id:b}).select().single();if(k)return console.log("[v0] Erro ao inserir cronograma:",k.message),{error:k.message};console.log("[v0] Cronograma inserido com sucesso:",f.cronograma_id);let l=[];for(let[b,c]of Object.entries(a.schedule))for(let[a,d]of Object.entries(c))if(d){let c=i[b],e=h[a],j=g[d];void 0!==c&&e&&j&&l.push({cronograma_id:f.cronograma_id,slots_dia:c,slots_hora_inicio:e.inicio,slots_hora_fim:e.fim,disciplina_id:j})}if(console.log("[v0] Inserindo",l.length,"slots"),l.length>0){let{error:a}=await e.from("slots").insert(l);if(a)return console.log("[v0] Erro ao inserir slots:",a.message),await e.from("cronograma").delete().eq("cronograma_id",f.cronograma_id),{error:a.message}}return console.log("[v0] Cronograma salvo com sucesso!"),(0,d.revalidatePath)("/agenda/cronograma"),{success:!0,cronogramaId:f.cronograma_id}}async function l(){let a=await j(),b=await (0,c.createServiceRoleClient)();console.log("[v0] Buscando cronogramas para userId:",a);let d=b.from("cronograma").select(`
      cronograma_id,
      cronograma_titulo,
      slots (
        slots_id,
        slots_dia,
        slots_hora_inicio,
        slots_hora_fim,
        disciplina (
          disciplina_id,
          disciplina_nome,
          disciplina_cor
        )
      )
    `);d=null===a?d.is("usuario_id",null):d.eq("usuario_id",a);let{data:e,error:f}=await d;return f?(console.log("[v0] Erro ao buscar cronogramas:",f.message),{error:f.message}):(console.log("[v0] Cronogramas encontrados:",e?.length),{data:e})}async function m(a){let b=await (0,c.createServiceRoleClient)();await b.from("slots").delete().eq("cronograma_id",a);let{error:e}=await b.from("cronograma").delete().eq("cronograma_id",a);return e?{error:e.message}:((0,d.revalidatePath)("/agenda/cronograma"),{success:!0})}(0,f.ensureServerEntryExports)([k,l,m]),(0,b.registerServerReference)(k,"4095dbef3e023288f92b9c8ecca97819bafe820fbc",null),(0,b.registerServerReference)(l,"007f22f9436701f7fd6860f9b884e19b8bb128b70b",null),(0,b.registerServerReference)(m,"40731975c44792de8684220a87093a00679ae61c85",null);var n=a.i(46535),o=a.i(92352),p=a.i(10600);a.s([],24422),a.i(24422),a.s(["001eee0ea2e32480cb65d838a8d69f2bc0ee4cb26f",()=>o.getProfile,"004848681f943a2fa6a735a7603fa78aeb2eff524a",()=>p.getTodayNotifications,"007f22f9436701f7fd6860f9b884e19b8bb128b70b",()=>l,"00a5c73d01448a448cafbf314f2103bda7312fd5f7",()=>n.signout,"40731975c44792de8684220a87093a00679ae61c85",()=>m,"4095dbef3e023288f92b9c8ecca97819bafe820fbc",()=>k,"605ad3937fcec750aa54a721f03bd83763ab184165",()=>o.saveProfile],84974)}];

//# sourceMappingURL=_b07c528b._.js.map