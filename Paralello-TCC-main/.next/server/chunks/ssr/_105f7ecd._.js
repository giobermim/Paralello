module.exports=[10600,a=>{"use strict";var b=a.i(37936),c=a.i(29024),d=a.i(18558),e=a.i(5246);async function f(){if((await (0,e.cookies)()).get("bypass_user"))return null;{let a=await (0,c.createServiceRoleClient)(),{data:{user:b}}=await a.auth.getUser();return b?.id||null}}async function g(){let a=await f(),b=await (0,c.createServiceRoleClient)(),d=b.from("evento").select("*").order("evento_data",{ascending:!0});d=null===a?d.is("usuario_id",null):d.eq("usuario_id",a);let[{data:e,error:g},{data:h}]=await Promise.all([d,b.from("tag").select("*")]);if(g)return{error:g.message};let i=e?.map(a=>a.evento_id)||[];console.log("[v0] Eventos encontrados:",i.length);let{data:j,error:k}=await b.from("tag_has_evento").select("*").in("evento_id",i);console.log("[v0] Tag relations encontradas:",j?.length||0,k?.message||"");let l=new Map;j?.forEach(a=>{let b=String(a.evento_id);l.has(b)||l.set(b,[]),l.get(b).push(a.tag_id)});let m=new Map(h?.map(a=>[a.tag_id,a]));return{data:(e||[]).map(a=>{let b=(l.get(String(a.evento_id))||[]).map(a=>m.get(a)).filter(Boolean);return console.log("[v0] Evento",a.evento_id,"tags:",b.length),{...a,tags:b}})}}async function h(a){let b=await f(),e=await (0,c.createServiceRoleClient)(),g=a.get("titulo"),h=a.get("descricao"),i=a.get("data"),j="true"===a.get("notificacao"),k=a.get("tag_ids"),{data:l,error:m}=await e.from("evento").insert({evento_titulo:g,evento_descricao:h,evento_data:i,evento_notificacao:j,usuario_id:b}).select().single();if(m)return{error:m.message};if(k){let a=k.split(",").filter(Boolean).map(a=>({evento_id:l.evento_id,tag_id:Number.parseInt(a)})),{error:b}=await e.from("tag_has_evento").insert(a);b&&console.error("Error adding tags:",b)}return(0,d.revalidatePath)("/agenda/calendario"),{success:!0,data:l}}async function i(a,b){let e=await f(),g=await (0,c.createServiceRoleClient)(),h=b.get("titulo"),i=b.get("descricao"),j=b.get("data"),k="true"===b.get("notificacao"),l=b.get("tag_ids"),m=g.from("evento").update({evento_titulo:h,evento_descricao:i,evento_data:j,evento_notificacao:k}).eq("evento_id",a);m=null===e?m.is("usuario_id",null):m.eq("usuario_id",e);let{error:n}=await m;if(n)return{error:n.message};if(await g.from("tag_has_evento").delete().eq("evento_id",Number.parseInt(a)),l){let b=l.split(",").filter(Boolean).map(b=>({evento_id:Number.parseInt(a),tag_id:Number.parseInt(b)}));await g.from("tag_has_evento").insert(b)}return(0,d.revalidatePath)("/agenda/calendario"),{success:!0}}async function j(a){let b=await f(),e=await (0,c.createServiceRoleClient)();return await Promise.all([e.from("tag_has_evento").delete().eq("evento_id",Number.parseInt(a)),(async()=>{let c=e.from("evento").delete().eq("evento_id",a);return null===b?c.is("usuario_id",null):c.eq("usuario_id",b)})()]),(0,d.revalidatePath)("/agenda/calendario"),{success:!0}}async function k(){let a=await f(),b=await (0,c.createServiceRoleClient)(),d=new Date().toISOString().split("T")[0],e=b.from("evento").select("*").eq("evento_data",d).eq("evento_notificacao",!0).order("evento_titulo",{ascending:!0});e=null===a?e.is("usuario_id",null):e.eq("usuario_id",a);let[{data:g,error:h},{data:i}]=await Promise.all([e,b.from("tag").select("*")]);if(h)return{error:h.message};let j=g?.map(a=>a.evento_id)||[],{data:k}=await b.from("tag_has_evento").select("*").in("evento_id",j),l=new Map;k?.forEach(a=>{let b=String(a.evento_id);l.has(b)||l.set(b,[]),l.get(b).push(a.tag_id)});let m=new Map(i?.map(a=>[a.tag_id,a]));return{data:(g||[]).map(a=>{let b=(l.get(String(a.evento_id))||[]).map(a=>m.get(a)).filter(Boolean);return{...a,tags:b}})}}(0,a.i(13095).ensureServerEntryExports)([g,h,i,j,k]),(0,b.registerServerReference)(g,"00ed5b835271d4cc4b8bf9cdca3bc525bc25d1274a",null),(0,b.registerServerReference)(h,"40f6ad126f174a86dd081f1986bf5166b4aec8fe18",null),(0,b.registerServerReference)(i,"60c6cd1767d79d6703e220f89d796da5fca0e1adae",null),(0,b.registerServerReference)(j,"4005ef675c21e61f593e536aed03f7e1aa4b652fbb",null),(0,b.registerServerReference)(k,"004848681f943a2fa6a735a7603fa78aeb2eff524a",null),a.s(["createEvento",()=>h,"deleteEvento",()=>j,"getEventos",()=>g,"getTodayNotifications",()=>k,"updateEvento",()=>i])},92352,a=>{"use strict";var b=a.i(37936),c=a.i(29024),d=a.i(5246);async function e(){if((await (0,d.cookies)()).get("bypass_user"))return"00000000-0000-0000-0000-000000000000";let a=await (0,c.createServerClient)(),{data:{user:b}}=await a.auth.getUser();return b?.id||null}async function f(){try{let a=await e();if(!a)return{success:!1,error:"Usuário não autenticado"};let b=await (0,c.createServerClient)(),{data:d,error:f}=await b.from("perfil_usuario").select("*").eq("usuario_id",a).maybeSingle();if(f)return console.error("Erro ao buscar perfil:",f),{success:!1,error:f.message};return{success:!0,data:d}}catch(a){return console.error("Erro ao buscar perfil:",a),{success:!1,error:"Erro ao buscar perfil"}}}async function g(a,b){try{let d=await e();if(!d)return{success:!1,error:"Usuário não autenticado"};let f=await (0,c.createServerClient)(),{data:g}=await f.from("perfil_usuario").select("perfil_id").eq("usuario_id",d).maybeSingle();if(g){let{error:c}=await f.from("perfil_usuario").update({perfil_nome:a,perfil_foto:b,updated_at:new Date().toISOString()}).eq("usuario_id",d);if(c)return console.error("Erro ao atualizar perfil:",c),{success:!1,error:c.message}}else{let{error:c}=await f.from("perfil_usuario").insert({usuario_id:d,perfil_nome:a,perfil_foto:b});if(c)return console.error("Erro ao criar perfil:",c),{success:!1,error:c.message}}return{success:!0}}catch(a){return console.error("Erro ao salvar perfil:",a),{success:!1,error:"Erro ao salvar perfil"}}}(0,a.i(13095).ensureServerEntryExports)([f,g]),(0,b.registerServerReference)(f,"001eee0ea2e32480cb65d838a8d69f2bc0ee4cb26f",null),(0,b.registerServerReference)(g,"605ad3937fcec750aa54a721f03bd83763ab184165",null),a.s(["getProfile",()=>f,"saveProfile",()=>g])},23605,a=>{"use strict";var b=a.i(46535),c=a.i(92352),d=a.i(10600);a.s([],7306),a.i(7306),a.s(["001eee0ea2e32480cb65d838a8d69f2bc0ee4cb26f",()=>c.getProfile,"004848681f943a2fa6a735a7603fa78aeb2eff524a",()=>d.getTodayNotifications,"00a5c73d01448a448cafbf314f2103bda7312fd5f7",()=>b.signout,"605ad3937fcec750aa54a721f03bd83763ab184165",()=>c.saveProfile],23605)}];

//# sourceMappingURL=_105f7ecd._.js.map